# CRMデータベース設計書（完全版）

## 📋 システム概要

### 目的
営業マンと営業管理者が使用するCRMシステムのデータベース設計

### 主要機能
1. **顧客管理** - 個人顧客の基本情報と営業ステータス管理
2. **面談管理** - Zoom面談の記録と結果管理
3. **契約管理** - 契約情報と支払方法の管理
4. **書類管理** - 契約書類の作成・郵送・チェック
5. **入金管理** - 入金予定と実績の追跡
6. **品質管理** - 書類チェックと面談収録チェック
7. **タスク管理** - 営業マンへの指示と進捗管理
8. **監査機能** - 全操作の履歴記録

---

## 🗂️ テーブル構成（全24テーブル）

### 📚 マスタテーブル（6テーブル）
選択肢や基準データを管理する基盤テーブル

| テーブル名 | 概要 | 主要データ |
|-----------|------|-----------|
| **M1. inflow_sources** | 流入経路マスタ | 個別、AI、予約専用、コンドウハルキ個別、コンドウハルキ公式、SP、アドプロ、オーガニック、送客 |
| **M2. meeting_results** | 面談結果マスタ | 成約、非成約、事前キャンセル、無断キャンセル、保留、契約済み（入金待ち）、スクール生、面談なし（採用）、入金前解除、入金前解除（信販否決）、クーリングオフ、担当変更 |
| **M3. payment_methods** | 支払方法マスタ | **階層構造**: 一括（銀振、MOSH、ユニヴァ、アスマイル、インフォカート、invoy）、分割（CBS、京都信販、日本プラム） |
| **M4. document_types** | 書類種別マスタ | 契約書、電子交付承諾書、概要書面 |
| **M5. document_check_items** | 書類チェック項目 | 書類種別ごとのチェック項目（氏名一致、金額正確性、署名確認等） |
| **M6. recording_check_items** | 収録チェック項目 | 面談種別ごとのチェック項目（挨拶、ニーズヒアリング、説明等） |

### 🏢 メインテーブル（18テーブル）
実際の業務データを管理するテーブル

#### 👥 ユーザー・顧客管理（3テーブル）
| テーブル名 | 概要 | 主要項目 |
|-----------|------|----------|
| **1. users** | ユーザー情報 | 氏名、LINE名、メール、役割（営業マン/営業管理/管理者） |
| **2. customers** | 顧客基本情報 | 氏名、LINE名、性別、年齢、地域、職業、本業、年収、流入経路 |
| **3. customer_assignments** | 顧客担当割当履歴 | 顧客ID、営業マンID、割当期間、現在担当フラグ |

#### 💼 営業活動管理（1テーブル）
| テーブル名 | 概要 | 主要項目 |
|-----------|------|----------|
| **4. meetings** | 面談記録 | 面談種別、日時、結果、録画URL、マインドマップURL、採用可否、温度感、紹介可能性、財務状況 |

#### 📝 契約・書類管理（6テーブル）
| テーブル名 | 概要 | 主要項目 |
|-----------|------|----------|
| **5. contracts** | 契約情報 | 契約番号、プラン（スタンダード/プライム/デザジュク）、金額、開始日、状況 |
| **6. contract_payment_methods** | 契約支払方法 | 契約ごとの支払方法（複数選択可）、割当金額・比率 |
| **7. contract_documents** | 契約書類 | 書類種別、書類名、URL、バージョン、承認状況 |
| **8. document_shipments** | 書類郵送管理 | 追跡番号、発送日、郵送完了、手紙作成者、信販会社提出状況 |
| **9. document_checks** | 書類チェック | チェック者、判定結果、修正依頼フラグ、修正期限 |
| **10. document_check_details** | 書類チェック詳細 | 項目別判定結果、指摘事項 |

#### 💰 入金管理（2テーブル）
| テーブル名 | 概要 | 主要項目 |
|-----------|------|----------|
| **11. payment_schedules** | 入金予定 | 分割回数、予定金額、予定日、状況 |
| **12. payment_records** | 入金実績 | 支払方法、入金額、入金日、確認者、確認日時 |

#### 🎥 品質管理（3テーブル）
| テーブル名 | 概要 | 主要項目 |
|-----------|------|----------|
| **13. recording_checks** | 収録チェック | チェック者、総合判定、スコア、改善指導フラグ |
| **14. recording_check_details** | 収録チェック詳細 | 項目別判定、スコア、該当時間、指摘事項 |
| **15. check_revision_requests** | 修正依頼管理 | 依頼種別、担当者、期限、状況、対応内容 |

#### 📨 コミュニケーション管理（2テーブル）
| テーブル名 | 概要 | 主要項目 |
|-----------|------|----------|
| **16. messages** | メッセージ | 送信者、受信者、件名、内容、既読状況 |
| **17. tasks** | タスク管理 | 担当者、依頼者、タスク種別、期限、状況 |

#### 📊 監査・ログ（1テーブル）
| テーブル名 | 概要 | 主要項目 |
|-----------|------|----------|
| **18. audit_logs** | 操作ログ | 操作者、操作対象、操作種別、変更前後の値、操作日時 |

---

## 🔄 主要な業務フロー

### 1️⃣ 顧客獲得〜面談フロー
```
顧客登録（LINE名必須） 
→ 営業マン割当 
→ 面談実施（Zoom） 
→ 面談記録作成 
→ 録画・マインドマップ保存
→ 収録チェック実施
```

### 2️⃣ 契約〜入金フロー
```
契約締結 
→ プラン・支払方法選択 
→ 契約書類作成（3種類） 
→ 書類チェック実施
→ 郵送手続き 
→ 入金予定作成 
→ 入金実績記録
```

### 3️⃣ 品質管理フロー
```
【書類チェック】
書類アップロード → チェック実施 → NG時修正依頼 → 再チェック

【収録チェック】  
面談実施 → 録画チェック → NG時改善指導 → スキル向上
```

---

## ✨ 主要な設計特徴

### 🎯 正規化による設計
- **第3正規形**: データの冗長性を排除
- **マスタテーブル**: 選択肢の一元管理で拡張性確保
- **外部キー制約**: データ整合性の保証

### 🔄 柔軟な関係設計
- **多対多関係**: 契約×支払方法で複数支払に対応
- **履歴管理**: 担当者変更や操作履歴を完全記録
- **ソフトデリート**: 論理削除でデータ保護

### 📈 拡張性への配慮
- **マスタテーブル**: 新しい選択肢を容易に追加
- **バージョン管理**: 書類の更新履歴を管理
- **パーティショニング**: 大量ログデータに対応

### 🛡️ セキュリティ対策
- **暗号化**: 個人情報・口座情報の暗号化
- **監査ログ**: 全操作の完全な記録
- **アクセス制御**: ロールベースの権限管理

---

## 📊 重要な関係性

### 顧客中心の関係
```
customers（顧客）を中心に
├── customer_assignments（担当者履歴）
├── meetings（面談記録）
├── contracts（契約情報）
├── messages（メッセージ）
└── tasks（タスク）
が関連
```

### 契約を起点とした関係
```
contracts（契約）から
├── contract_payment_methods（支払方法）
├── contract_documents（書類）→ document_checks（チェック）
├── document_shipments（郵送）
├── payment_schedules（入金予定）
└── payment_records（入金実績）
に展開
```

### 品質管理の関係
```
document_checks（書類チェック）
recording_checks（収録チェック）
　　　　　↓
check_revision_requests（修正依頼）
　　　　　↓
tasks（タスク）→ 営業マンへの指示
```

---

## 🎯 期待される効果

### 📈 業務効率化
- **一元管理**: 顧客情報から契約、入金まで統合管理
- **自動化**: チェック結果による自動タスク生成
- **標準化**: チェック項目の統一で品質安定化

### 📊 データ分析
- **成約率分析**: 流入経路・面談種別別の成約率
- **品質評価**: 書類・面談の品質スコア推移
- **営業効率**: 営業マン別のパフォーマンス分析

### 🔒 コンプライアンス
- **監査対応**: 全操作の完全な履歴記録
- **データ保護**: 個人情報の適切な暗号化
- **品質保証**: 書類・面談の品質チェック体制

### 🎓 教育・改善
- **スキル向上**: 面談チェックによる具体的指導
- **継続改善**: PDCAサイクルによる品質向上
- **ベストプラクティス**: 成功パターンの共有

---

## 🚀 実装推奨順序

### Phase 1: 基盤構築
1. マスタテーブル群の構築
2. ユーザー・顧客・担当者管理
3. 基本的な面談・契約管理

### Phase 2: 業務機能
1. 書類管理・郵送機能
2. 入金管理機能
3. メッセージ・タスク管理

### Phase 3: 品質管理
1. 書類チェック機能
2. 収録チェック機能
3. 修正依頼システム

### Phase 4: 分析・最適化
1. レポート・ダッシュボード
2. パフォーマンス最適化
3. 監査・セキュリティ強化

この設計により、営業プロセス全体をデジタル化し、品質向上と効率化を同時に実現できる包括的なCRMシステムが構築できます。